<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SEO Dashboard - Just Dev It</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
            min-height: 100vh;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .header {
            background: white;
            padding: 30px;
            border-radius: 20px;
            margin-bottom: 20px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.1);
        }

        .header h1 {
            color: #667eea;
            font-size: 32px;
            margin-bottom: 10px;
        }

        .header p {
            color: #666;
            font-size: 14px;
        }

        .header .last-update {
            margin-top: 15px;
            padding: 10px 15px;
            background: #f0f4ff;
            border-radius: 8px;
            display: inline-block;
            font-size: 13px;
            color: #667eea;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .stat-card {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.08);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0,0,0,0.15);
        }

        .stat-card .label {
            color: #888;
            font-size: 13px;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 10px;
        }

        .stat-card .value {
            font-size: 36px;
            font-weight: bold;
            color: #333;
            margin-bottom: 10px;
        }

        .stat-card .change {
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .stat-card .change.positive {
            color: #10b981;
        }

        .stat-card .change.negative {
            color: #ef4444;
        }

        .stat-card .change.neutral {
            color: #6b7280;
        }

        .main-grid {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        .card {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.08);
        }

        .card h2 {
            color: #333;
            font-size: 20px;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .card h2::before {
            content: '';
            width: 4px;
            height: 24px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 2px;
        }

        .keywords-table {
            width: 100%;
            border-collapse: collapse;
        }

        .keywords-table th {
            text-align: left;
            padding: 12px;
            background: #f8f9fa;
            font-size: 12px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            color: #666;
            border-bottom: 2px solid #e5e7eb;
        }

        .keywords-table td {
            padding: 15px 12px;
            border-bottom: 1px solid #f3f4f6;
            font-size: 14px;
        }

        .keywords-table tr:hover {
            background: #f9fafb;
        }

        .keyword-position {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 20px;
            font-weight: 600;
            font-size: 12px;
        }

        .position-top3 {
            background: #d1fae5;
            color: #065f46;
        }

        .position-top10 {
            background: #dbeafe;
            color: #1e40af;
        }

        .position-top20 {
            background: #fef3c7;
            color: #92400e;
        }

        .position-low {
            background: #f3f4f6;
            color: #6b7280;
        }

        .trend-icon {
            font-size: 16px;
            margin-left: 5px;
        }

        .chart-container {
            width: 100%;
            height: 300px;
            margin-top: 20px;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: #e5e7eb;
            border-radius: 10px;
            overflow: hidden;
            margin-top: 8px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            border-radius: 10px;
            transition: width 0.3s ease;
        }

        .goal-item {
            padding: 15px;
            background: #f9fafb;
            border-radius: 10px;
            margin-bottom: 15px;
        }

        .goal-item h4 {
            color: #333;
            font-size: 14px;
            margin-bottom: 8px;
        }

        .goal-item .goal-stats {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 13px;
            color: #666;
            margin-top: 8px;
        }

        .action-buttons {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 10px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .btn-secondary {
            background: white;
            color: #667eea;
            border: 2px solid #667eea;
        }

        .btn-secondary:hover {
            background: #f0f4ff;
        }

        .alert {
            padding: 15px 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .alert-info {
            background: #dbeafe;
            color: #1e40af;
            border-left: 4px solid #3b82f6;
        }

        .alert-warning {
            background: #fef3c7;
            color: #92400e;
            border-left: 4px solid #f59e0b;
        }

        .alert-success {
            background: #d1fae5;
            color: #065f46;
            border-left: 4px solid #10b981;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #666;
        }

        .spinner {
            border: 4px solid #f3f4f6;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #666;
        }

        .empty-state svg {
            width: 100px;
            height: 100px;
            margin-bottom: 20px;
            opacity: 0.5;
        }

        .config-section {
            background: #f9fafb;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
        }

        .config-section h3 {
            color: #333;
            font-size: 16px;
            margin-bottom: 15px;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            color: #666;
            font-size: 13px;
            margin-bottom: 5px;
            font-weight: 600;
        }

        .form-group input,
        .form-group textarea {
            width: 100%;
            padding: 10px 15px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.3s ease;
        }

        .form-group input:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #667eea;
        }

        .form-group textarea {
            min-height: 100px;
            font-family: monospace;
            resize: vertical;
        }

        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            border-bottom: 2px solid #e5e7eb;
        }

        .tab {
            padding: 12px 24px;
            background: none;
            border: none;
            color: #666;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            transition: all 0.3s ease;
        }

        .tab.active {
            color: #667eea;
            border-bottom-color: #667eea;
        }

        .tab:hover {
            color: #667eea;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        @media (max-width: 1024px) {
            .main-grid {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 768px) {
            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            .action-buttons {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1>üìä SEO Dashboard - Just Dev It</h1>
            <p>Monitoreo de posicionamiento org√°nico en tiempo real</p>
            <div class="last-update" id="lastUpdate">
                üïê √öltima actualizaci√≥n: Nunca
            </div>
        </div>

        <!-- Alerts -->
        <div id="alerts"></div>

        <!-- Action Buttons -->
        <div class="action-buttons">
            <button class="btn btn-primary" onclick="fetchData()">
                üîÑ Actualizar Datos
            </button>
            <button class="btn btn-secondary" onclick="exportData()">
                üì• Exportar CSV
            </button>
            <button class="btn btn-secondary" onclick="showConfig()">
                ‚öôÔ∏è Configuraci√≥n
            </button>
        </div>

        <!-- Tabs -->
        <div class="tabs">
            <button class="tab active" onclick="switchTab('overview')">üìà Overview</button>
            <button class="tab" onclick="switchTab('keywords')">üîç Keywords</button>
            <button class="tab" onclick="switchTab('goals')">üéØ Objetivos</button>
            <button class="tab" onclick="switchTab('config')">‚öôÔ∏è Configuraci√≥n</button>
        </div>

        <!-- Tab: Overview -->
        <div id="tab-overview" class="tab-content active">
            <!-- Stats Grid -->
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="label">Total Impresiones</div>
                    <div class="value" id="stat-impressions">0</div>
                    <div class="change neutral" id="change-impressions">
                        <span>‚Üí</span> Sin datos previos
                    </div>
                </div>

                <div class="stat-card">
                    <div class="label">Total Clics</div>
                    <div class="value" id="stat-clicks">0</div>
                    <div class="change neutral" id="change-clicks">
                        <span>‚Üí</span> Sin datos previos
                    </div>
                </div>

                <div class="stat-card">
                    <div class="label">CTR Promedio</div>
                    <div class="value" id="stat-ctr">0%</div>
                    <div class="change neutral" id="change-ctr">
                        <span>‚Üí</span> Sin datos previos
                    </div>
                </div>

                <div class="stat-card">
                    <div class="label">Posici√≥n Promedio</div>
                    <div class="value" id="stat-position">0</div>
                    <div class="change neutral" id="change-position">
                        <span>‚Üí</span> Sin datos previos
                    </div>
                </div>
            </div>

            <!-- Main Grid -->
            <div class="main-grid">
                <div class="card">
                    <h2>üìà Tendencia √öltimos 7 D√≠as</h2>
                    <div class="chart-container">
                        <canvas id="trendChart"></canvas>
                    </div>
                </div>

                <div class="card">
                    <h2>üéØ Objetivos del Mes</h2>
                    <div id="goals-summary">
                        <div class="goal-item">
                            <h4>Impresiones</h4>
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: 0%"></div>
                            </div>
                            <div class="goal-stats">
                                <span>0 / 1,000</span>
                                <span>0%</span>
                            </div>
                        </div>

                        <div class="goal-item">
                            <h4>Clics</h4>
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: 0%"></div>
                            </div>
                            <div class="goal-stats">
                                <span>0 / 20</span>
                                <span>0%</span>
                            </div>
                        </div>

                        <div class="goal-item">
                            <h4>Keywords en Top 10</h4>
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: 0%"></div>
                            </div>
                            <div class="goal-stats">
                                <span>0 / 5</span>
                                <span>0%</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Tab: Keywords -->
        <div id="tab-keywords" class="tab-content">
            <div class="card">
                <h2>üîç Top Keywords</h2>
                <div id="keywords-loading" class="loading" style="display: none;">
                    <div class="spinner"></div>
                    <p>Cargando keywords...</p>
                </div>
                <div id="keywords-empty" class="empty-state">
                    <p>üì≠ No hay datos de keywords todav√≠a</p>
                    <p style="font-size: 14px; margin-top: 10px;">Haz clic en "Actualizar Datos" o configura tu API Key</p>
                </div>
                <table class="keywords-table" id="keywords-table" style="display: none;">
                    <thead>
                        <tr>
                            <th>Keyword</th>
                            <th>Posici√≥n</th>
                            <th>Impresiones</th>
                            <th>Clics</th>
                            <th>CTR</th>
                            <th>Tendencia</th>
                        </tr>
                    </thead>
                    <tbody id="keywords-tbody">
                        <!-- Datos din√°micos -->
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Tab: Goals -->
        <div id="tab-goals" class="tab-content">
            <div class="card">
                <h2>üéØ Objetivos y Metas</h2>
                <div id="goals-detail">
                    <!-- Se llenar√° din√°micamente -->
                </div>
            </div>
        </div>

        <!-- Tab: Config -->
        <div id="tab-config" class="tab-content">
            <div class="card">
                <h2>‚öôÔ∏è Configuraci√≥n de APIs</h2>
                
                <div class="config-section">
                    <h3>Google Search Console API</h3>
                    <div class="form-group">
                        <label>Property URL</label>
                        <input type="text" id="config-property" placeholder="https://justdev.it" value="https://justdev.it">
                    </div>
                    <div class="form-group">
                        <label>Service Account JSON (Credentials)</label>
                        <textarea id="config-credentials" placeholder='{"type": "service_account", "project_id": "...", ...}'></textarea>
                        <small style="color: #666; font-size: 12px; margin-top: 5px; display: block;">
                            ‚ÑπÔ∏è Obt√©n esto desde Google Cloud Console ‚Üí APIs & Services ‚Üí Credentials
                        </small>
                    </div>
                </div>

                <div class="config-section">
                    <h3>Google Analytics 4</h3>
                    <div class="form-group">
                        <label>Property ID</label>
                        <input type="text" id="config-ga-property" placeholder="G-E47YX9JYCS" value="G-E47YX9JYCS">
                    </div>
                    <div class="form-group">
                        <label>Measurement ID</label>
                        <input type="text" id="config-ga-measurement" placeholder="398327180">
                    </div>
                </div>

                <button class="btn btn-primary" onclick="saveConfig()">
                    üíæ Guardar Configuraci√≥n
                </button>
                
                <button class="btn btn-secondary" onclick="testConnection()">
                    üîå Probar Conexi√≥n
                </button>
            </div>

            <div class="card" style="margin-top: 20px;">
                <h2>üìö Gu√≠a de Configuraci√≥n</h2>
                <div style="line-height: 1.8; color: #666; font-size: 14px;">
                    <h3 style="color: #333; margin: 20px 0 10px;">1. Google Search Console API</h3>
                    <ol style="padding-left: 20px;">
                        <li>Ve a <a href="https://console.cloud.google.com" target="_blank" style="color: #667eea;">Google Cloud Console</a></li>
                        <li>Crea un proyecto nuevo (o usa uno existente)</li>
                        <li>Habilita "Google Search Console API"</li>
                        <li>Ve a "Credentials" ‚Üí "Create Credentials" ‚Üí "Service Account"</li>
                        <li>Descarga el JSON de credenciales</li>
                        <li>Copia el contenido del JSON y p√©galo arriba</li>
                        <li>En Search Console, agrega el email del service account como usuario</li>
                    </ol>

                    <h3 style="color: #333; margin: 20px 0 10px;">2. Google Analytics 4</h3>
                    <ol style="padding-left: 20px;">
                        <li>Ve a tu propiedad de GA4</li>
                        <li>Admin ‚Üí Property Settings</li>
                        <li>Copia el "Property ID" (ej: G-E47YX9JYCS)</li>
                        <li>Copia el "Measurement ID"</li>
                        <li>P√©galos en los campos arriba</li>
                    </ol>

                    <h3 style="color: #333; margin: 20px 0 10px;">‚ö†Ô∏è Seguridad</h3>
                    <p>
                        Esta aplicaci√≥n corre 100% en local. Tus credenciales se guardan en 
                        <code style="background: #f3f4f6; padding: 2px 6px; border-radius: 4px;">localStorage</code> 
                        de tu navegador y NUNCA se env√≠an a ning√∫n servidor externo.
                    </p>
                </div>
            </div>
        </div>
    </div>

    <!-- Chart.js Library -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>

    <script>
        // Estado global de la aplicaci√≥n
        const appState = {
            data: null,
            config: null,
            lastUpdate: null,
            chart: null
        };

        // Cargar configuraci√≥n guardada
        function loadConfig() {
            const savedConfig = localStorage.getItem('seo-dashboard-config');
            if (savedConfig) {
                appState.config = JSON.parse(savedConfig);
                document.getElementById('config-property').value = appState.config.property || 'https://justdev.it';
                document.getElementById('config-credentials').value = appState.config.credentials || '';
                document.getElementById('config-ga-property').value = appState.config.gaProperty || 'G-E47YX9JYCS';
                document.getElementById('config-ga-measurement').value = appState.config.gaMeasurement || '';
            }
        }

        // Guardar configuraci√≥n
        async function saveConfig() {
            const propertyUrl = document.getElementById('config-property').value;
            const credentialsText = document.getElementById('config-credentials').value;
            const gaProperty = document.getElementById('config-ga-property').value;
            const gaMeasurement = document.getElementById('config-ga-measurement').value;
            
            // Validar que se ingresaron los datos requeridos
            if (!propertyUrl || !credentialsText) {
                showAlert('warning', '‚ö†Ô∏è Por favor completa al menos la URL de la propiedad y las credenciales');
                return;
            }
            
            // Intentar parsear las credenciales JSON
            let serviceAccountJson;
            try {
                serviceAccountJson = JSON.parse(credentialsText);
            } catch (e) {
                showAlert('error', '‚ùå El JSON de credenciales no es v√°lido. Revisa el formato.');
                return;
            }
            
            const config = {
                propertyUrl: propertyUrl,
                serviceAccountJson: serviceAccountJson,
                analyticsPropertyId: gaProperty,
                measurementId: gaMeasurement
            };
            
            // Guardar en localStorage (para el navegador)
            const configForStorage = {
                property: propertyUrl,
                credentials: credentialsText,
                gaProperty: gaProperty,
                gaMeasurement: gaMeasurement
            };
            localStorage.setItem('seo-dashboard-config', JSON.stringify(configForStorage));
            appState.config = configForStorage;
            
            // Intentar guardar en archivo config.json (para el script autom√°tico)
            try {
                const response = await fetch('http://localhost:5000/api/save-config', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(config)
                });
                
                if (response.ok) {
                    showAlert('success', '‚úÖ Configuraci√≥n guardada correctamente (navegador + archivo)');
                } else {
                    showAlert('success', '‚úÖ Configuraci√≥n guardada en navegador (servidor no disponible para archivo)');
                }
            } catch (error) {
                // Si el servidor no est√° corriendo, solo guardamos en localStorage
                showAlert('success', '‚úÖ Configuraci√≥n guardada en navegador');
                console.log('Nota: Para que funcione la actualizaci√≥n autom√°tica, inicia el servidor API primero');
            }
        }

        // Probar conexi√≥n (simulado por ahora)
        async function testConnection() {
            showAlert('info', 'üîÑ Probando conexi√≥n...');
            
            // Simulaci√≥n - en producci√≥n har√≠a una llamada real a la API
            setTimeout(() => {
                if (appState.config && appState.config.credentials) {
                    showAlert('success', '‚úÖ Conexi√≥n exitosa con Google Search Console');
                } else {
                    showAlert('warning', '‚ö†Ô∏è Por favor configura tus credenciales primero');
                }
            }, 1500);
        }

        // Mostrar alertas
        function showAlert(type, message) {
            const alertsContainer = document.getElementById('alerts');
            const alert = document.createElement('div');
            alert.className = `alert alert-${type}`;
            alert.textContent = message;
            
            alertsContainer.appendChild(alert);
            
            setTimeout(() => {
                alert.remove();
            }, 5000);
        }

        // Cambiar de tab
        function switchTab(tabName) {
            // Ocultar todos los tabs
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Mostrar el tab seleccionado
            document.getElementById(`tab-${tabName}`).classList.add('active');
            event.target.classList.add('active');
        }

        // Fetch datos (simulado - aqu√≠ ir√≠an las llamadas reales a las APIs)
        async function fetchData() {
            showAlert('info', 'üîÑ Actualizando datos...');
            
            // Por ahora, datos de ejemplo
            // En producci√≥n, aqu√≠ har√≠as las llamadas a Google Search Console API
            const mockData = generateMockData();
            
            appState.data = mockData;
            appState.lastUpdate = new Date();
            
            updateUI(mockData);
            saveDataToLocalStorage(mockData);
            
            showAlert('success', '‚úÖ Datos actualizados correctamente');
        }

        // Generar datos de ejemplo
        function generateMockData() {
            return {
                summary: {
                    impressions: Math.floor(Math.random() * 1000) + 500,
                    clicks: Math.floor(Math.random() * 50) + 20,
                    ctr: (Math.random() * 3 + 1).toFixed(2),
                    position: (Math.random() * 10 + 5).toFixed(1)
                },
                keywords: [
                    {
                        keyword: 'desarrollo de software fintech Santiago',
                        position: 8,
                        impressions: 450,
                        clicks: 12,
                        ctr: 2.7,
                        trend: 'up'
                    },
                    {
                        keyword: 'web scraping selenium Chile',
                        position: 12,
                        impressions: 320,
                        clicks: 8,
                        ctr: 2.5,
                        trend: 'up'
                    },
                    {
                        keyword: 'desarrollo a medida Ruby Santiago',
                        position: 15,
                        impressions: 180,
                        clicks: 3,
                        ctr: 1.7,
                        trend: 'neutral'
                    },
                    {
                        keyword: 'metabase Chile',
                        position: 10,
                        impressions: 210,
                        clicks: 5,
                        ctr: 2.4,
                        trend: 'up'
                    },
                    {
                        keyword: 'data engineering Chile',
                        position: 18,
                        impressions: 290,
                        clicks: 6,
                        ctr: 2.1,
                        trend: 'down'
                    }
                ],
                trend: [
                    { date: '2025-10-28', impressions: 420, clicks: 15 },
                    { date: '2025-10-29', impressions: 450, clicks: 18 },
                    { date: '2025-10-30', impressions: 480, clicks: 20 },
                    { date: '2025-10-31', impressions: 510, clicks: 22 },
                    { date: '2025-11-01', impressions: 530, clicks: 24 },
                    { date: '2025-11-02', impressions: 550, clicks: 26 },
                    { date: '2025-11-03', impressions: 580, clicks: 28 }
                ]
            };
        }

        // Actualizar UI con los datos
        function updateUI(data) {
            // Actualizar stats
            document.getElementById('stat-impressions').textContent = data.summary.impressions.toLocaleString();
            document.getElementById('stat-clicks').textContent = data.summary.clicks.toLocaleString();
            document.getElementById('stat-ctr').textContent = data.summary.ctr + '%';
            document.getElementById('stat-position').textContent = data.summary.position;
            
            // Actualizar √∫ltima actualizaci√≥n
            document.getElementById('lastUpdate').textContent = 
                `üïê √öltima actualizaci√≥n: ${appState.lastUpdate.toLocaleString('es-CL')}`;
            
            // Actualizar tabla de keywords
            updateKeywordsTable(data.keywords);
            
            // Actualizar gr√°fico
            updateChart(data.trend);
            
            // Actualizar objetivos
            updateGoals(data);
        }

        // Actualizar tabla de keywords
        function updateKeywordsTable(keywords) {
            const tbody = document.getElementById('keywords-tbody');
            tbody.innerHTML = '';
            
            document.getElementById('keywords-empty').style.display = 'none';
            document.getElementById('keywords-table').style.display = 'table';
            
            keywords.forEach(kw => {
                const row = document.createElement('tr');
                
                const positionClass = kw.position <= 3 ? 'position-top3' :
                                     kw.position <= 10 ? 'position-top10' :
                                     kw.position <= 20 ? 'position-top20' : 'position-low';
                
                const trendIcon = kw.trend === 'up' ? 'üìà' :
                                 kw.trend === 'down' ? 'üìâ' : '‚Üí';
                
                row.innerHTML = `
                    <td style="font-weight: 500;">${kw.keyword}</td>
                    <td><span class="keyword-position ${positionClass}">#${kw.position}</span></td>
                    <td>${kw.impressions.toLocaleString()}</td>
                    <td>${kw.clicks}</td>
                    <td>${kw.ctr}%</td>
                    <td><span class="trend-icon">${trendIcon}</span></td>
                `;
                
                tbody.appendChild(row);
            });
        }

        // Actualizar gr√°fico
        function updateChart(trendData) {
            const ctx = document.getElementById('trendChart');
            
            if (appState.chart) {
                appState.chart.destroy();
            }
            
            appState.chart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: trendData.map(d => {
                        const date = new Date(d.date);
                        return date.toLocaleDateString('es-CL', { month: 'short', day: 'numeric' });
                    }),
                    datasets: [
                        {
                            label: 'Impresiones',
                            data: trendData.map(d => d.impressions),
                            borderColor: '#667eea',
                            backgroundColor: 'rgba(102, 126, 234, 0.1)',
                            tension: 0.4,
                            fill: true
                        },
                        {
                            label: 'Clics',
                            data: trendData.map(d => d.clicks),
                            borderColor: '#764ba2',
                            backgroundColor: 'rgba(118, 75, 162, 0.1)',
                            tension: 0.4,
                            fill: true
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: true,
                            position: 'top'
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
        }

        // Actualizar objetivos
        function updateGoals(data) {
            const goals = [
                { name: 'Impresiones', current: data.summary.impressions, target: 1000 },
                { name: 'Clics', current: data.summary.clicks, target: 20 },
                { name: 'Keywords en Top 10', current: data.keywords.filter(k => k.position <= 10).length, target: 5 }
            ];
            
            const goalsSummary = document.getElementById('goals-summary');
            goalsSummary.innerHTML = '';
            
            goals.forEach(goal => {
                const percentage = Math.min((goal.current / goal.target) * 100, 100);
                
                const goalItem = document.createElement('div');
                goalItem.className = 'goal-item';
                goalItem.innerHTML = `
                    <h4>${goal.name}</h4>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: ${percentage}%"></div>
                    </div>
                    <div class="goal-stats">
                        <span>${goal.current.toLocaleString()} / ${goal.target.toLocaleString()}</span>
                        <span>${percentage.toFixed(0)}%</span>
                    </div>
                `;
                
                goalsSummary.appendChild(goalItem);
            });
        }

        // Exportar datos a CSV
        function exportData() {
            if (!appState.data) {
                showAlert('warning', '‚ö†Ô∏è No hay datos para exportar');
                return;
            }
            
            let csv = 'Keyword,Posicion,Impresiones,Clics,CTR\n';
            
            appState.data.keywords.forEach(kw => {
                csv += `"${kw.keyword}",${kw.position},${kw.impressions},${kw.clicks},${kw.ctr}\n`;
            });
            
            const blob = new Blob([csv], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `seo-report-${new Date().toISOString().split('T')[0]}.csv`;
            a.click();
            
            showAlert('success', '‚úÖ Datos exportados correctamente');
        }

        // Guardar datos en localStorage
        function saveDataToLocalStorage(data) {
            localStorage.setItem('seo-dashboard-data', JSON.stringify(data));
            localStorage.setItem('seo-dashboard-last-update', appState.lastUpdate.toISOString());
        }

        // Cargar datos desde localStorage
        function loadDataFromLocalStorage() {
            const savedData = localStorage.getItem('seo-dashboard-data');
            const savedLastUpdate = localStorage.getItem('seo-dashboard-last-update');
            
            if (savedData && savedLastUpdate) {
                appState.data = JSON.parse(savedData);
                appState.lastUpdate = new Date(savedLastUpdate);
                updateUI(appState.data);
            }
        }

        // Mostrar modal de configuraci√≥n
        function showConfig() {
            switchTab('config');
        }

        // Inicializaci√≥n
        document.addEventListener('DOMContentLoaded', () => {
            loadConfig();
            loadDataFromLocalStorage();
            
            // Si no hay datos, mostrar mensaje
            if (!appState.data) {
                showAlert('info', '‚ÑπÔ∏è Bienvenido! Configura tus APIs y haz clic en "Actualizar Datos" para comenzar');
            }
        });
    </script>
</body>
</html>
